class App {
    constructor() {
        this.PJAX_TIMEOUT_MS = 6000;
        this.MAIN_CONTAINER_NAME = "main";
        this.previousScrollTop = 0;
        this.previousScrollTop = 0;
        this.listener = new AppListener(this);
        this.pagesCtrl = new PagesCtrl();
        this.errorHandler = new ErrorHandler();
        this.initPages();
    }
    start() {
        const self = this;
        self.setupMenuButtons();
        self.setupAccountDropdown();
        moment.updateLocale("en", {
            week: { dow: 1 }
        });
        $.pjax.defaults.timeout = self.PJAX_TIMEOUT_MS;
        let wasNewPage = false;
        let onPageChangeStart = function (isNewPage, isReloadingPreviousPage) {
            self.listener.showLoading();
            DropdownBox.closeAllVisible();
            wasNewPage = isNewPage;
            if (!isReloadingPreviousPage) {
                let previousScrollTop = $(window).scrollTop();
                self.previousScrollTop = previousScrollTop;
            }
        };
        let onPageChangeFinish = function (success) {
            if (!success) {
                self.listener.hideLoading();
                return;
            }
            if (wasNewPage) {
                $(window).scrollTop(0);
            }
            else {
                $(window).scrollTop(self.previousScrollTop);
                self.previousScrollTop = 0;
            }
            self.pagesCtrl.setupPage();
            self.listener.hideLoading();
            self.listener.setupForms();
            self.setupAccountDropdown();
        };
        let mainLoader = MainLoader.getInstance();
        mainLoader.init(self.MAIN_CONTAINER_NAME, onPageChangeStart, onPageChangeFinish);
        self.linksLoader = LinksLoader.getInstance();
        mainLoader.addLoader(self.linksLoader, "a.ajax");
        let formsLoader = FormsLoader.getInstance();
        formsLoader.setOnFormLoadStartedListener(function (form) {
            let ajaxForm = new AjaxForm();
            ajaxForm.disableForm(form);
        });
        mainLoader.addLoader(formsLoader, "form.ajax");
        self.listener.setupForms();
        self.pagesCtrl.setupPage();
    }
    setupAccountDropdown() {
        setTimeout(() => {
            if ($("#dropdownAccount").length == 0)
                return;
            let dropdown = new DropdownBox();
            dropdown.init("#dropdownAccount");
        });
    }
    setupMenuButtons() {
        const self = this;
        $("body")
            .off("click", "#btnAccount")
            .on("click", "#btnAccount", event => {
            let dropdown = $("#dropdownAccount")[0];
            if (dropdown && dropdown.display) {
                dropdown.display($("#btnAccount"));
            }
        });
    }
    addErrorHandling() {
        window.onerror = this.errorHandler.getHandler();
    }
    initPages() {
        this.pagesCtrl.addPage(new PageCreateAccount(this.listener));
        this.pagesCtrl.addPage(new PageInvoiceDetails(this.listener));
        this.pagesCtrl.addPage(new PageEditInvoice(this.listener));
        this.pagesCtrl.addPage(new PageEditPayout(this.listener));
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvYXBwL21haW4vc2NyaXB0cy9BcHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUE7SUFZRTtRQVhRLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLHdCQUFtQixHQUFRLE1BQU0sQ0FBQztRQVFuQyxzQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFHM0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUNqQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDdkMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFTSxLQUFLO1FBQ1YsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRWxCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBRTVCLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFO1lBQ3hCLElBQUksRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7U0FDakIsQ0FBQyxDQUFDO1FBR0gsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDL0MsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBRXZCLElBQUksaUJBQWlCLEdBQUcsVUFBUyxTQUFTLEVBQUUsdUJBQXVCO1lBQ2pFLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUIsV0FBVyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzlCLFVBQVUsR0FBRyxTQUFTLENBQUM7WUFFdkIsSUFBSSxDQUFDLHVCQUF1QixFQUFFO2dCQUM1QixJQUFJLGlCQUFpQixHQUFHLENBQUMs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O0lBRU8sU0FBUztRQUNmLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUMzRCxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLGNBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0NBQ0YiLCJmaWxlIjoic3JjL2NsaWVudC9hcHAvbWFpbi9zY3JpcHRzL0FwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJBcHBMaXN0ZW5lci50c1wiLz5cblxuZGVjbGFyZSBsZXQgTDogYW55O1xuZGVjbGFyZSBsZXQgTlByb2dyZXNzOiBhbnk7XG5kZWNsYXJlIGxldCBtb21lbnQ6IGFueTtcblxuY2xhc3MgQXBwIHtcbiAgcHJpdmF0ZSBQSkFYX1RJTUVPVVRfTVMgPSA2MDAwO1xuICBwcml2YXRlIE1BSU5fQ09OVEFJTkVSX05BTUU6IGFueSA9IFwibWFpblwiO1xuXG4gIHB1YmxpYyBsaW5rc0xvYWRlcjogTGlua3NMb2FkZXI7XG5cbiAgcHVibGljIHBhZ2VzQ3RybDogUGFnZXNDdHJsO1xuICBwdWJsaWMgbGlzdGVuZXI6IEFwcExpc3RlbmVyO1xuICBwdWJsaWMgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXI7XG5cbiAgcHVibGljIHByZXZpb3VzU2Nyb2xsVG9wID0gMDtcblxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wcmV2aW91c1Njcm9sbFRvcCA9IDA7XG4gICAgdGhpcy5saXN0ZW5lciA9IG5ldyBBcHBMaXN0ZW5lcih0aGlzKTtcbiAgICB0aGlzLnBhZ2VzQ3RybCA9IG5ldyBQYWdlc0N0cmwoKTtcbiAgICB0aGlzLmVycm9ySGFuZGxlciA9IG5ldyBFcnJvckhhbmRsZXIoKTtcbiAgICB0aGlzLmluaXRQYWdlcygpO1xuICB9XG5cbiAgcHVibGljIHN0YXJ0KCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5zZXR1cE1lbnVCdXR0b25zKCk7XG4gICAgc2VsZi5zZXR1cEFjY291bnREcm9wZG93bigpO1xuXG4gICAgbW9tZW50LnVwZGF0ZUxvY2FsZShcImVuXCIsIHtcbiAgICAgIHdlZWs6IHsgZG93OiAxIH0gLy8gTW9uZGF5IGlzIHRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWtcbiAgICB9KTtcblxuICAgIC8vIEluaXQgbG9hZGVycyBjb250cm9sbGVyXG4gICAgJC5wamF4LmRlZmF1bHRzLnRpbWVvdXQgPSBzZWxmLlBKQVhfVElNRU9VVF9NUztcbiAgICBsZXQgd2FzTmV3UGFnZSA9IGZhbHNlO1xuXG4gICAgbGV0IG9uUGFnZUNoYW5nZVN0YXJ0ID0gZnVuY3Rpb24oaXNOZXdQYWdlLCBpc1JlbG9hZGluZ1ByZXZpb3VzUGFnZSkge1xuICAgICAgc2VsZi5saXN0ZW5lci5zaG93TG9hZGluZygpO1xuICAgICAgRHJvcGRvd25Cb3guY2xvc2VBbGxWaXNpYmxlKCk7XG4gICAgICB3YXNOZXdQYWdlID0gaXNOZXdQYWdlO1xuXG4gICAgICBpZiAoIWlzUmVsb2FkaW5nUHJldmlvdXNQYWdlKSB7XG4gICAgICAgIGxldCBwcmV2aW91c1Njcm9sbFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgICAgc2VsZi5wcmV2aW91c1Njcm9sbFRvcCA9IHByZXZpb3VzU2Nyb2xsVG9wO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBMb2FkZXJcbiAgICBsZXQgb25QYWdlQ2hhbmdlRmluaXNoID0gZnVuY3Rpb24oc3VjY2Vzcykge1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIHNlbGYubGlzdGVuZXIuaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAod2FzTmV3UGFnZSkge1xuICAgICAgICAkKHdpbmRvdykuc2Nyb2xsVG9wKDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJCh3aW5kb3cpLnNjcm9sbFRvcChzZWxmLnByZXZpb3VzU2Nyb2xsVG9wKTtcbiAgICAgICAgc2VsZi5wcmV2aW91c1Njcm9sbFRvcCA9IDA7XG4gICAgICB9XG5cbiAgICAgIHNlbGYucGFnZXNDdHJsLnNldHVwUGFnZSgpO1xuXG4gICAgICBzZWxmLmxpc3RlbmVyLmhpZGVMb2FkaW5nKCk7XG4gICAgICBzZWxmLmxpc3RlbmVyLnNldHVwRm9ybXMoKTtcblxuICAgICAgc2VsZi5zZXR1cEFjY291bnREcm9wZG93bigpO1xuICAgIH07XG5cbiAgICBsZXQgbWFpbkxvYWRlciA9IE1haW5Mb2FkZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICBtYWluTG9hZGVyLmluaXQoc2VsZi5NQUlOX0NPTlRBSU5FUl9OQU1FLCBvblBhZ2VDaGFuZ2VTdGFydCwgb25QYWdlQ2hhbmdlRmluaXNoKTtcblxuICAgIC8vIEFkZCBsb2FkZXJzIGNvbXBvbmVudFxuICAgIHNlbGYubGlua3NMb2FkZXIgPSBMaW5rc0xvYWRlci5nZXRJbnN0YW5jZSgpO1xuICAgIG1haW5Mb2FkZXIuYWRkTG9hZGVyKHNlbGYubGlua3NMb2FkZXIsIFwiYS5hamF4XCIpO1xuXG4gICAgbGV0IGZvcm1zTG9hZGVyID0gRm9ybXNMb2FkZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICBmb3Jtc0xvYWRlci5zZXRPbkZvcm1Mb2FkU3RhcnRlZExpc3RlbmVyKGZ1bmN0aW9uKGZvcm0pIHtcbiAgICAgIGxldCBhamF4Rm9ybSA9IG5ldyBBamF4Rm9ybSgpO1xuICAgICAgYWpheEZvcm0uZGlzYWJsZUZvcm0oZm9ybSk7XG4gICAgfSk7XG4gICAgbWFpbkxvYWRlci5hZGRMb2FkZXIoZm9ybXNMb2FkZXIsIFwiZm9ybS5hamF4XCIpO1xuXG4gICAgc2VsZi5saXN0ZW5lci5zZXR1cEZvcm1zKCk7XG4gICAgc2VsZi5wYWdlc0N0cmwuc2V0dXBQYWdlKCk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwQWNjb3VudERyb3Bkb3duKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCQoXCIjZHJvcGRvd25BY2NvdW50XCIpLmxlbmd0aCA9PSAwKSByZXR1cm47XG4gICAgICBsZXQgZHJvcGRvd24gPSBuZXcgRHJvcGRvd25Cb3goKTtcbiAgICAgIGRyb3Bkb3duLmluaXQoXCIjZHJvcGRvd25BY2NvdW50XCIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cE1lbnVCdXR0b25zKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgJChcImJvZHlcIilcbiAgICAgIC5vZmYoXCJjbGlja1wiLCBcIiNidG5BY2NvdW50XCIpXG4gICAgICAub24oXCJjbGlja1wiLCBcIiNidG5BY2NvdW50XCIsIGV2ZW50ID0+IHtcbiAgICAgICAgbGV0IGRyb3Bkb3duOiBhbnkgPSAkKFwiI2Ryb3Bkb3duQWNjb3VudFwiKVswXTtcbiAgICAgICAgaWYgKGRyb3Bkb3duICYmIGRyb3Bkb3duLmRpc3BsYXkpIHtcbiAgICAgICAgICBkcm9wZG93bi5kaXNwbGF5KCQoXCIjYnRuQWNjb3VudFwiKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFkZEVycm9ySGFuZGxpbmcoKSB7XG4gICAgd2luZG93Lm9uZXJyb3IgPSB0aGlzLmVycm9ySGFuZGxlci5nZXRIYW5kbGVyKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRQYWdlcygpIHtcbiAgICB0aGlzLnBhZ2VzQ3RybC5hZGRQYWdlKG5ldyBQYWdlQ3JlYXRlQWNjb3VudCh0aGlzLmxpc3RlbmVyKSk7XG4gICAgdGhpcy5wYWdlc0N0cmwuYWRkUGFnZShuZXcgUGFnZUludm9pY2VEZXRhaWxzKHRoaXMubGlzdGVuZXIpKTtcbiAgICB0aGlzLnBhZ2VzQ3RybC5hZGRQYWdlKG5ldyBQYWdlRWRpdEludm9pY2UodGhpcy5saXN0ZW5lcikpO1xuICAgIHRoaXMucGFnZXNDdHJsLmFkZFBhZ2UobmV3IFBhZ2VFZGl0UGF5b3V0KHRoaXMubGlzdGVuZXIpKTtcbiAgfVxufVxuIl19
