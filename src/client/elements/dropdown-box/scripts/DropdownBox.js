class DropdownBox {
    constructor() {
        this.isVisible = false;
        this.isBlocked = false;
        this.onCloseCallback = {};
    }
    static closeAllVisible() {
        DropdownBox.visibleDropdowns.forEach(function (item) {
            item.close();
        });
    }
    static closeAllVisibleOnClick(event) {
        DropdownBox.visibleDropdowns.forEach(function (item) {
            item.closeOnTap(event);
        });
    }
    init(selectorId) {
        const self = this;
        self.host = $(selectorId);
        if (!!self.host[0].isLoaded)
            return;
        self.isVisible = false;
        self.setOnCloseCallback(function () { });
        let loadedStructure = self.loadStructure();
        if (!loadedStructure) {
            self.createStructure();
        }
        window.addEventListener("resize", function () {
            let isVisible = $(self).is(":visible");
            if (isVisible) {
                self.setPosition();
            }
        }, true);
        $(self.background)
            .off("click")
            .on("click", event => {
            self.close();
        });
        self.host[0].isLoaded = true;
        self.exportMethods();
    }
    exportMethods() {
        this.host[0].setOnCloseCallback = this.setOnCloseCallback.bind(this);
        this.host[0].display = this.display.bind(this);
        this.host[0].closeOnTap = this.closeOnTap.bind(this);
        this.host[0].close = this.close.bind(this);
        this.host[0].hide = this.hide.bind(this);
    }
    setOnCloseCallback(onCloseCallback) {
        this.onCloseCallback = onCloseCallback;
    }
    getHost() {
        return this.host;
    }
    display(attachTo) {
        if (this.isBlocked) {
            return;
        }
        const self = this;
        if (this.isVisible) {
            this.close();
        }
        else {
            this.setAnchor(attachTo);
            this.setPosition();
            this.show();
        }
    }
    closeOnTap(event) {
        if (!this.isEventTarget(this.host, event)) {
            this.close();
        }
    }
    close() {
        this.hide();
        this.onCloseCallback();
    }
    hide() {
        if (this.isVisible && !this.isBlocked) {
            setTimeout(function () {
                self.isVisible = false;
            }, 100);
            const self = this;
            self.host.hide();
            self.removeFromVisible();
            this.blockInteractionsTemporary();
        }
    }
    loadStructure() {
        this.dropdown = $("." + DropdownBox.ELEMENT_CLASS_MAIN, this.host);
        this.anchor = $("." + DropdownBox.ELEMENT_CLASS_ANCHOR, this.host);
        this.container = $("." + DropdownBox.ELEMENT_CLASS_CONTENT, this.host);
        this.background = $("." + DropdownBox.ELEMENT_CLASS_BG, this.host);
        let isLoaded = this.dropdown.length && this.anchor.length && this.container.length && this.background.length;
        return isLoaded;
    }
    createStructure() {
        const self = this;
        this.dropdown = $('<div class="' + DropdownBox.ELEMENT_CLASS_MAIN + '"></div>');
        this.anchor = $('<div class="' + DropdownBox.ELEMENT_CLASS_ANCHOR + '"></div>');
        this.container = $('<div class="' + DropdownBox.ELEMENT_CLASS_CONTENT + '"></div>');
        this.background = $('<div class="' + DropdownBox.ELEMENT_CLASS_BG + '"></div>');
        let contentDropdown = $(this.host.html());
        this.host.empty();
        this.dropdown.appendTo(self.host);
        this.anchor.appendTo(self.dropdown);
        this.container.appendTo(self.dropdown);
        contentDropdown.appendTo(self.container);
        this.background.appendTo(self.host);
    }
    setAnchor(attachTo) {
        this.attachTo = attachTo;
    }
    setPosition() {
        const self = this;
        let wasVisible = $(this).is(":visible");
        if (!wasVisible) {
            self.host.show();
        }
        let contentWidth = self.container.outerWidth();
        let anchorWidth = $(self.anchor).innerWidth();
        if (!wasVisible) {
            self.host.hide();
        }
        let yMargin = DropdownBox.MARGIN_Y;
        let yPos = self.attachTo.offset().top - $(window).scrollTop() + self.attachTo.height() + yMargin;
        let xPosMiddle = self.attachTo.offset().left + self.attachTo.outerWidth() / 2 - contentWidth / 2;
        let xAnchor = contentWidth / 2 - anchorWidth / 2;
        let xPos = xPosMiddle;
        let xMargin = DropdownBox.MARGIN_X;
        let xMax = $(this.host)
            .parent()
            .width() -
            contentWidth -
            xMargin;
        let xMin = xMargin;
        xMax = Math.max(xMax, xMin);
        xPos = Math.max(xMin, xPos);
        xPos = Math.min(xMax, xPos);
        let xPosDiff = xPos - xPosMiddle;
        xAnchor -= xPosDiff;
        let xMaxAnchor = contentWidth - anchorWidth;
        let xMinAnchor = 0;
        xAnchor = Math.max(xMinAnchor, xAnchor);
        xAnchor = Math.min(xMaxAnchor, xAnchor);
        self.dropdown.css("top", yPos);
        self.dropdown.css("left", xPos);
        $(self.anchor).css("margin-left", xAnchor);
    }
    show() {
        if (!this.isVisible && !this.isBlocked) {
            const self = this;
            self.host.show();
            self.isVisible = true;
            this.addToVisible();
            this.blockInteractionsTemporary();
        }
    }
    addToVisible() {
        let index = DropdownBox.visibleDropdowns.indexOf(this, 0);
        if (index != undefined && index != null) {
            DropdownBox.visibleDropdowns.push(this);
        }
    }
    removeFromVisible() {
        let index = DropdownBox.visibleDropdowns.indexOf(this, 0);
        if (index != undefined && index != null) {
            DropdownBox.visibleDropdowns.splice(index, 1);
        }
    }
    blockInteractionsTemporary() {
        const self = this;
        this.isBlocked = true;
        setTimeout(function () {
            self.isBlocked = false;
        }, 100);
    }
    isEventTarget(element, event) {
        let target = undefined;
        if (event.detail == undefined || event.detail.sourceEvent == undefined) {
            target = event.target;
        }
        else {
            target = event.detail.sourceEvent.target;
        }
        return element.get(0).is(target) || element.get(0).has(target).length != 0;
    }
}
DropdownBox.visibleDropdowns = [];
DropdownBox.MARGIN_X = 10;
DropdownBox.MARGIN_Y = 0;
DropdownBox.ELEMENT_CLASS_MAIN = "app-dropdown-main";
DropdownBox.ELEMENT_CLASS_ANCHOR = "app-dropdown-anchor";
DropdownBox.ELEMENT_CLASS_CONTENT = "app-dropdown-content";
DropdownBox.ELEMENT_CLASS_BG = "app-dropdown-bg";

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvZWxlbWVudHMvZHJvcGRvd24tYm94L3NjcmlwdHMvRHJvcGRvd25Cb3gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFpQ0U7UUFoQkEsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUMzQixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLG9CQUFlLEdBQVEsRUFBRSxDQUFDO0lBY1gsQ0FBQztJQVpULE1BQU0sQ0FBQyxlQUFlO1FBQzNCLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsVUFBUyxJQUFpQjtZQUM3RCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTSxNQUFNLENBQUMsc0JBQXNCLENBQUMsS0FBVTtRQUM3QyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQVMsSUFBaUI7WUFDN0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFJTSxJQUFJLENBQUMsVUFBVTtRQUNwQixNQUFNLElBQUksR0FBUSxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFMUIsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRO1lBQUUsT0FBTztRQUdwQyxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLENBQUMsa0JBQWtCLENBQUMsY0FBWSxDQUFDLENBQUMsQ0FBQztRQUd2QyxJQUFJLGVBQWUsR0FBWSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDcEQsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUNwQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDeEI7UUFFRCxNQUFNLENBQUMsZ0JBQWdCLENBQ3JCLFFBQVEsRUFDUjtZQUNFLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdkMsSUFBSSxTQUFTLEVBQUU7Z0JBQ2IsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQ3BCO1FBQ0gsQ0FBQyxFQUNELElBQUksQ0FDTCxDQUFDO1FBRUYsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDZixHQUFHLENBQUMsT0FBTyxDQUFDO2FBQ1osRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRTtZQUNuQixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztRQUVMLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUM3QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVPLGFBQWE7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFTSxrQkFBa0IsQ0FBQyxlQUFvQjtRQUM1QyxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztJQUN6QyxDQUFDO0lBRU0sT0FBTztRQUNaLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztJQUNuQixDQUFDO0lBRU0sT0FBTyxDQUFDLFFBQWE7UUFDMUIsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2xCLE9BQU87U0FDUjtRQUVELE1BQU0sSUFBSSxHQUFRLElBQUksQ0FBQztRQUV2QixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbEIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2Q7YUFBTTtZQUNMLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDekIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ25CLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUVNLFVBQVUsQ0FBQyxLQUFVO1FBRTFCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDekMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2Q7SUFDSCxDQUFDO0lBRU0sS0FBSztRQUNWLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNaLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRU0sSUFBSTtRQUNULElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDckMsVUFBVSxDQUFDO2dCQUNULElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNSLE1BQU0sSUFBSSxHQUFRLElBQUksQ0FBQztZQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1NBQ25DO0lBQ0gsQ0FBQztJQUVPLGFBQWE7UUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkUsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkUsSUFBSSxRQUFRLEdBQVksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7UUFDdEgsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVPLGVBQWU7UUFDckIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLGNBQWMsR0FBRyxXQUFXLENBQUMsa0JBQWtCLEdBQUcsVUFBVSxDQUFDLENBQUM7UUFDaEYsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsY0FBYyxHQUFHLFdBQVcsQ0FBQyxvQkFBb0IsR0FBRyxVQUFVLENBQUMsQ0FBQztRQUNoRixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxjQUFjLEdBQUcsV0FBVyxDQUFDLHFCQUFxQixHQUFHLFVBQVUsQ0FBQyxDQUFDO1FBQ3BGLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLGNBQWMsR0FBRyxXQUFXLENBQUMsZ0JBQWdCLEdBQUcsVUFBVSxDQUFDLENBQUM7UUFHaEYsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBR2xCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRU8sU0FBUyxDQUFDLFFBQVE7UUFDeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFDM0IsQ0FBQztJQUVPLFdBQVc7UUFDakIsTUFBTSxJQUFJLEdBQVEsSUFBSSxDQUFDO1FBQ3ZCLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFeEMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDbEI7UUFFRCxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQy9DLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFFOUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDbEI7UUFFRCxJQUFJLE9BQU8sR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDO1FBQ25DLElBQUksSUFBSSxHQUFXLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQztRQUN6RyxJQUFJLFVBQVUsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsR0FBRyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3pHLElBQUksT0FBTyxHQUFHLFlBQVksR0FBRyxDQUFDLEdBQUcsV0FBVyxHQUFHLENBQUMsQ0FBQztRQUdqRCxJQUFJLElBQUksR0FBRyxVQUFVLENBQUM7UUFFdEIsSUFBSSxPQUFPLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQztRQUNuQyxJQUFJLElBQUksR0FDTixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNULE1BQU0sRUFBRTthQUNSLEtBQUssRUFBRTtZQUNWLFlBQVk7WUFDWixPQUFPLENBQUM7UUFFVixJQUFJLElBQUksR0FBRyxPQUFPLENBQUM7UUFFbkIsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTVCLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM1QixJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFHNUIsSUFBSSxRQUFRLEdBQUcsSUFBSSxHQUFHLFVBQVUsQ0FBQztRQUNqQyxPQUFPLElBQUksUUFBUSxDQUFDO1FBQ3BCLElBQUksVUFBVSxHQUFHLFlBQVksR0FBRyxXQUFXLENBQUM7UUFDNUMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBRW5CLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4QyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFeEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVPLElBQUk7UUFDVixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDdEMsTUFBTSxJQUFJLEdBQVEsSUFBSSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDakIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFDdEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1NBQ25DO0lBQ0gsQ0FBQztJQUVPLFlBQVk7UUFDbEIsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUQsSUFBSSxLQUFLLElBQUksU0FBUyxJQUFJLEtBQUssSUFBSSxJQUFJLEVBQUU7WUFDdkMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6QztJQUNILENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUQsSUFBSSxLQUFLLElBQUksU0FBUyxJQUFJLEtBQUssSUFBSSxJQUFJLEVBQUU7WUFDdkMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDL0M7SUFDSCxDQUFDO0lBRU8sMEJBQTBCO1FBQ2hDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixVQUFVLENBQUM7WUFDVCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN6QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDVixDQUFDO0lBRU8sYUFBYSxDQUFDLE9BQU8sRUFBRSxLQUFLO1FBQ2xDLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUN2QixJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksU0FBUyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxJQUFJLFNBQVMsRUFBRTtZQUN0RSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztTQUN2QjthQUFNO1lBQ0wsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQztTQUMxQztRQUVELE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQztJQUM3RSxDQUFDOztBQTdQYSw0QkFBZ0IsR0FBdUIsRUFBRSxDQUFDO0FBRXpDLG9CQUFRLEdBQVcsRUFBRSxDQUFDO0FBQ3RCLG9CQUFRLEdBQVcsQ0FBQyxDQUFDO0FBRXJCLDhCQUFrQixHQUFXLG1CQUFtQixDQUFDO0FBQ2pELGdDQUFvQixHQUFXLHFCQUFxQixDQUFDO0FBQ3JELGlDQUFxQixHQUFXLHNCQUFzQixDQUFDO0FBQ3ZELDRCQUFnQixHQUFXLGlCQUFpQixDQUFDIiwiZmlsZSI6InNyYy9jbGllbnQvZWxlbWVudHMvZHJvcGRvd24tYm94L3NjcmlwdHMvRHJvcGRvd25Cb3guanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBEcm9wZG93bkJveCB7XG4gIHB1YmxpYyBzdGF0aWMgdmlzaWJsZURyb3Bkb3duczogQXJyYXk8RHJvcGRvd25Cb3g+ID0gW107XG5cbiAgcHJpdmF0ZSBzdGF0aWMgTUFSR0lOX1g6IG51bWJlciA9IDEwO1xuICBwcml2YXRlIHN0YXRpYyBNQVJHSU5fWTogbnVtYmVyID0gMDtcblxuICBwcml2YXRlIHN0YXRpYyBFTEVNRU5UX0NMQVNTX01BSU46IHN0cmluZyA9IFwiYXBwLWRyb3Bkb3duLW1haW5cIjtcbiAgcHJpdmF0ZSBzdGF0aWMgRUxFTUVOVF9DTEFTU19BTkNIT1I6IHN0cmluZyA9IFwiYXBwLWRyb3Bkb3duLWFuY2hvclwiO1xuICBwcml2YXRlIHN0YXRpYyBFTEVNRU5UX0NMQVNTX0NPTlRFTlQ6IHN0cmluZyA9IFwiYXBwLWRyb3Bkb3duLWNvbnRlbnRcIjtcbiAgcHJpdmF0ZSBzdGF0aWMgRUxFTUVOVF9DTEFTU19CRzogc3RyaW5nID0gXCJhcHAtZHJvcGRvd24tYmdcIjtcblxuICBob3N0OiBhbnk7XG4gIGRyb3Bkb3duOiBhbnk7XG4gIGFuY2hvcjogYW55O1xuICBiYWNrZ3JvdW5kOiBhbnk7XG4gIGNvbnRhaW5lcjogYW55O1xuICBhdHRhY2hUbzogYW55O1xuICBpc1Zpc2libGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgaXNCbG9ja2VkOiBib29sZWFuID0gZmFsc2U7XG4gIG9uQ2xvc2VDYWxsYmFjazogYW55ID0ge307XG5cbiAgcHVibGljIHN0YXRpYyBjbG9zZUFsbFZpc2libGUoKSB7XG4gICAgRHJvcGRvd25Cb3gudmlzaWJsZURyb3Bkb3ducy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW06IERyb3Bkb3duQm94KSB7XG4gICAgICBpdGVtLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGNsb3NlQWxsVmlzaWJsZU9uQ2xpY2soZXZlbnQ6IGFueSkge1xuICAgIERyb3Bkb3duQm94LnZpc2libGVEcm9wZG93bnMuZm9yRWFjaChmdW5jdGlvbihpdGVtOiBEcm9wZG93bkJveCkge1xuICAgICAgaXRlbS5jbG9zZU9uVGFwKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBwdWJsaWMgaW5pdChzZWxlY3RvcklkKSB7XG4gICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcbiAgICBzZWxmLmhvc3QgPSAkKHNlbGVjdG9ySWQpO1xuXG4gICAgaWYgKCEhc2VsZi5ob3N0WzBdLmlzTG9hZGVkKSByZXR1cm47XG5cbiAgICAvLyBJbml0aWF0ZSBkYXRhXG4gICAgc2VsZi5pc1Zpc2libGUgPSBmYWxzZTtcbiAgICBzZWxmLnNldE9uQ2xvc2VDYWxsYmFjayhmdW5jdGlvbigpIHt9KTtcblxuICAgIC8vIFByZXBhcmUgYWxsIGVsZW1lbnRzXG4gICAgbGV0IGxvYWRlZFN0cnVjdHVyZTogYm9vbGVhbiA9IHNlbGYubG9hZFN0cnVjdHVyZSgpO1xuICAgIGlmICghbG9hZGVkU3RydWN0dXJlKSB7XG4gICAgICBzZWxmLmNyZWF0ZVN0cnVjdHVyZSgpO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJyZXNpemVcIixcbiAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBsZXQgaXNWaXNpYmxlID0gJChzZWxmKS5pcyhcIjp2aXNpYmxlXCIpO1xuICAgICAgICBpZiAoaXNWaXNpYmxlKSB7XG4gICAgICAgICAgc2VsZi5zZXRQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJ1ZVxuICAgICk7XG5cbiAgICAkKHNlbGYuYmFja2dyb3VuZClcbiAgICAgIC5vZmYoXCJjbGlja1wiKVxuICAgICAgLm9uKFwiY2xpY2tcIiwgZXZlbnQgPT4ge1xuICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICB9KTtcblxuICAgIHNlbGYuaG9zdFswXS5pc0xvYWRlZCA9IHRydWU7XG4gICAgc2VsZi5leHBvcnRNZXRob2RzKCk7XG4gIH1cblxuICBwcml2YXRlIGV4cG9ydE1ldGhvZHMoKSB7XG4gICAgdGhpcy5ob3N0WzBdLnNldE9uQ2xvc2VDYWxsYmFjayA9IHRoaXMuc2V0T25DbG9zZUNhbGxiYWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5ob3N0WzBdLmRpc3BsYXkgPSB0aGlzLmRpc3BsYXkuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhvc3RbMF0uY2xvc2VPblRhcCA9IHRoaXMuY2xvc2VPblRhcC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaG9zdFswXS5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhvc3RbMF0uaGlkZSA9IHRoaXMuaGlkZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgcHVibGljIHNldE9uQ2xvc2VDYWxsYmFjayhvbkNsb3NlQ2FsbGJhY2s6IGFueSkge1xuICAgIHRoaXMub25DbG9zZUNhbGxiYWNrID0gb25DbG9zZUNhbGxiYWNrO1xuICB9XG5cbiAgcHVibGljIGdldEhvc3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuaG9zdDtcbiAgfVxuXG4gIHB1YmxpYyBkaXNwbGF5KGF0dGFjaFRvOiBhbnkpIHtcbiAgICBpZiAodGhpcy5pc0Jsb2NrZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0QW5jaG9yKGF0dGFjaFRvKTtcbiAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgIHRoaXMuc2hvdygpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjbG9zZU9uVGFwKGV2ZW50OiBhbnkpIHtcbiAgICAvLyBDbG9zZSBpZiBldmVudCB3YXMgb3V0c2lkZSBvZiBkaWFsb2cgYm94XG4gICAgaWYgKCF0aGlzLmlzRXZlbnRUYXJnZXQodGhpcy5ob3N0LCBldmVudCkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgdGhpcy5oaWRlKCk7XG4gICAgdGhpcy5vbkNsb3NlQ2FsbGJhY2soKTtcbiAgfVxuXG4gIHB1YmxpYyBoaWRlKCkge1xuICAgIGlmICh0aGlzLmlzVmlzaWJsZSAmJiAhdGhpcy5pc0Jsb2NrZWQpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuaXNWaXNpYmxlID0gZmFsc2U7XG4gICAgICB9LCAxMDApO1xuICAgICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcbiAgICAgIHNlbGYuaG9zdC5oaWRlKCk7XG4gICAgICBzZWxmLnJlbW92ZUZyb21WaXNpYmxlKCk7XG4gICAgICB0aGlzLmJsb2NrSW50ZXJhY3Rpb25zVGVtcG9yYXJ5KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBsb2FkU3RydWN0dXJlKCk6IGJvb2xlYW4ge1xuICAgIHRoaXMuZHJvcGRvd24gPSAkKFwiLlwiICsgRHJvcGRvd25Cb3guRUxFTUVOVF9DTEFTU19NQUlOLCB0aGlzLmhvc3QpO1xuICAgIHRoaXMuYW5jaG9yID0gJChcIi5cIiArIERyb3Bkb3duQm94LkVMRU1FTlRfQ0xBU1NfQU5DSE9SLCB0aGlzLmhvc3QpO1xuICAgIHRoaXMuY29udGFpbmVyID0gJChcIi5cIiArIERyb3Bkb3duQm94LkVMRU1FTlRfQ0xBU1NfQ09OVEVOVCwgdGhpcy5ob3N0KTtcbiAgICB0aGlzLmJhY2tncm91bmQgPSAkKFwiLlwiICsgRHJvcGRvd25Cb3guRUxFTUVOVF9DTEFTU19CRywgdGhpcy5ob3N0KTtcblxuICAgIGxldCBpc0xvYWRlZDogYm9vbGVhbiA9IHRoaXMuZHJvcGRvd24ubGVuZ3RoICYmIHRoaXMuYW5jaG9yLmxlbmd0aCAmJiB0aGlzLmNvbnRhaW5lci5sZW5ndGggJiYgdGhpcy5iYWNrZ3JvdW5kLmxlbmd0aDtcbiAgICByZXR1cm4gaXNMb2FkZWQ7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVN0cnVjdHVyZSgpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICB0aGlzLmRyb3Bkb3duID0gJCgnPGRpdiBjbGFzcz1cIicgKyBEcm9wZG93bkJveC5FTEVNRU5UX0NMQVNTX01BSU4gKyAnXCI+PC9kaXY+Jyk7XG4gICAgdGhpcy5hbmNob3IgPSAkKCc8ZGl2IGNsYXNzPVwiJyArIERyb3Bkb3duQm94LkVMRU1FTlRfQ0xBU1NfQU5DSE9SICsgJ1wiPjwvZGl2PicpO1xuICAgIHRoaXMuY29udGFpbmVyID0gJCgnPGRpdiBjbGFzcz1cIicgKyBEcm9wZG93bkJveC5FTEVNRU5UX0NMQVNTX0NPTlRFTlQgKyAnXCI+PC9kaXY+Jyk7XG4gICAgdGhpcy5iYWNrZ3JvdW5kID0gJCgnPGRpdiBjbGFzcz1cIicgKyBEcm9wZG93bkJveC5FTEVNRU5UX0NMQVNTX0JHICsgJ1wiPjwvZGl2PicpO1xuXG4gICAgLy8gTW92ZSBkcm9wZG93biBjb250ZW50IHRvIGNvbnRhaW5lclxuICAgIGxldCBjb250ZW50RHJvcGRvd24gPSAkKHRoaXMuaG9zdC5odG1sKCkpO1xuICAgIHRoaXMuaG9zdC5lbXB0eSgpO1xuXG4gICAgLy8gQWRkIGFsbCBlbGVtZW50c1xuICAgIHRoaXMuZHJvcGRvd24uYXBwZW5kVG8oc2VsZi5ob3N0KTtcbiAgICB0aGlzLmFuY2hvci5hcHBlbmRUbyhzZWxmLmRyb3Bkb3duKTtcbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRUbyhzZWxmLmRyb3Bkb3duKTtcbiAgICBjb250ZW50RHJvcGRvd24uYXBwZW5kVG8oc2VsZi5jb250YWluZXIpO1xuICAgIHRoaXMuYmFja2dyb3VuZC5hcHBlbmRUbyhzZWxmLmhvc3QpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRBbmNob3IoYXR0YWNoVG8pIHtcbiAgICB0aGlzLmF0dGFjaFRvID0gYXR0YWNoVG87XG4gIH1cblxuICBwcml2YXRlIHNldFBvc2l0aW9uKCkge1xuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG4gICAgbGV0IHdhc1Zpc2libGUgPSAkKHRoaXMpLmlzKFwiOnZpc2libGVcIik7XG5cbiAgICBpZiAoIXdhc1Zpc2libGUpIHtcbiAgICAgIHNlbGYuaG9zdC5zaG93KCk7XG4gICAgfVxuXG4gICAgbGV0IGNvbnRlbnRXaWR0aCA9IHNlbGYuY29udGFpbmVyLm91dGVyV2lkdGgoKTtcbiAgICBsZXQgYW5jaG9yV2lkdGggPSAkKHNlbGYuYW5jaG9yKS5pbm5lcldpZHRoKCk7XG5cbiAgICBpZiAoIXdhc1Zpc2libGUpIHtcbiAgICAgIHNlbGYuaG9zdC5oaWRlKCk7XG4gICAgfVxuXG4gICAgbGV0IHlNYXJnaW4gPSBEcm9wZG93bkJveC5NQVJHSU5fWTtcbiAgICBsZXQgeVBvczogbnVtYmVyID0gc2VsZi5hdHRhY2hUby5vZmZzZXQoKS50b3AgLSAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyBzZWxmLmF0dGFjaFRvLmhlaWdodCgpICsgeU1hcmdpbjtcbiAgICBsZXQgeFBvc01pZGRsZTogbnVtYmVyID0gc2VsZi5hdHRhY2hUby5vZmZzZXQoKS5sZWZ0ICsgc2VsZi5hdHRhY2hUby5vdXRlcldpZHRoKCkgLyAyIC0gY29udGVudFdpZHRoIC8gMjtcbiAgICBsZXQgeEFuY2hvciA9IGNvbnRlbnRXaWR0aCAvIDIgLSBhbmNob3JXaWR0aCAvIDI7XG5cbiAgICAvLyBDaGVjayBpZiBjb250YWluZXIgZml0cyBpbnRvIHNjcmVlblxuICAgIGxldCB4UG9zID0geFBvc01pZGRsZTtcblxuICAgIGxldCB4TWFyZ2luID0gRHJvcGRvd25Cb3guTUFSR0lOX1g7XG4gICAgbGV0IHhNYXggPVxuICAgICAgJCh0aGlzLmhvc3QpXG4gICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAud2lkdGgoKSAtXG4gICAgICBjb250ZW50V2lkdGggLVxuICAgICAgeE1hcmdpbjtcblxuICAgIGxldCB4TWluID0geE1hcmdpbjtcblxuICAgIHhNYXggPSBNYXRoLm1heCh4TWF4LCB4TWluKTtcblxuICAgIHhQb3MgPSBNYXRoLm1heCh4TWluLCB4UG9zKTtcbiAgICB4UG9zID0gTWF0aC5taW4oeE1heCwgeFBvcyk7XG5cbiAgICAvLyBBZGp1c3QgYW5jaG9yIGlmIHdlIG5lZWQgdG9cbiAgICBsZXQgeFBvc0RpZmYgPSB4UG9zIC0geFBvc01pZGRsZTtcbiAgICB4QW5jaG9yIC09IHhQb3NEaWZmO1xuICAgIGxldCB4TWF4QW5jaG9yID0gY29udGVudFdpZHRoIC0gYW5jaG9yV2lkdGg7XG4gICAgbGV0IHhNaW5BbmNob3IgPSAwO1xuXG4gICAgeEFuY2hvciA9IE1hdGgubWF4KHhNaW5BbmNob3IsIHhBbmNob3IpO1xuICAgIHhBbmNob3IgPSBNYXRoLm1pbih4TWF4QW5jaG9yLCB4QW5jaG9yKTtcblxuICAgIHNlbGYuZHJvcGRvd24uY3NzKFwidG9wXCIsIHlQb3MpO1xuICAgIHNlbGYuZHJvcGRvd24uY3NzKFwibGVmdFwiLCB4UG9zKTtcbiAgICAkKHNlbGYuYW5jaG9yKS5jc3MoXCJtYXJnaW4tbGVmdFwiLCB4QW5jaG9yKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdygpIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlICYmICF0aGlzLmlzQmxvY2tlZCkge1xuICAgICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcbiAgICAgIHNlbGYuaG9zdC5zaG93KCk7XG4gICAgICBzZWxmLmlzVmlzaWJsZSA9IHRydWU7XG4gICAgICB0aGlzLmFkZFRvVmlzaWJsZSgpO1xuICAgICAgdGhpcy5ibG9ja0ludGVyYWN0aW9uc1RlbXBvcmFyeSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkVG9WaXNpYmxlKCkge1xuICAgIGxldCBpbmRleCA9IERyb3Bkb3duQm94LnZpc2libGVEcm9wZG93bnMuaW5kZXhPZih0aGlzLCAwKTtcbiAgICBpZiAoaW5kZXggIT0gdW5kZWZpbmVkICYmIGluZGV4ICE9IG51bGwpIHtcbiAgICAgIERyb3Bkb3duQm94LnZpc2libGVEcm9wZG93bnMucHVzaCh0aGlzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUZyb21WaXNpYmxlKCkge1xuICAgIGxldCBpbmRleCA9IERyb3Bkb3duQm94LnZpc2libGVEcm9wZG93bnMuaW5kZXhPZih0aGlzLCAwKTtcbiAgICBpZiAoaW5kZXggIT0gdW5kZWZpbmVkICYmIGluZGV4ICE9IG51bGwpIHtcbiAgICAgIERyb3Bkb3duQm94LnZpc2libGVEcm9wZG93bnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGJsb2NrSW50ZXJhY3Rpb25zVGVtcG9yYXJ5KCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5pc0Jsb2NrZWQgPSBmYWxzZTtcbiAgICB9LCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0V2ZW50VGFyZ2V0KGVsZW1lbnQsIGV2ZW50KSB7XG4gICAgbGV0IHRhcmdldCA9IHVuZGVmaW5lZDtcbiAgICBpZiAoZXZlbnQuZGV0YWlsID09IHVuZGVmaW5lZCB8fCBldmVudC5kZXRhaWwuc291cmNlRXZlbnQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldCA9IGV2ZW50LmRldGFpbC5zb3VyY2VFdmVudC50YXJnZXQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0KDApLmlzKHRhcmdldCkgfHwgZWxlbWVudC5nZXQoMCkuaGFzKHRhcmdldCkubGVuZ3RoICE9IDA7XG4gIH1cbn1cbiJdfQ==
