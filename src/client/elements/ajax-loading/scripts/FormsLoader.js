class FormsLoader extends BaseLoader {
    constructor() {
        super(...arguments);
        this._isLoading = false;
        this.focusedElementId = null;
    }
    static getInstance() {
        if (!FormsLoader.instance) {
            FormsLoader.instance = new FormsLoader();
        }
        return FormsLoader.instance;
    }
    init(isOtherLoadingCallback, triggerOn, mainContainerId) {
        const self = this;
        this.triggerOn = triggerOn;
        this.isOtherLoadingCallback = isOtherLoadingCallback;
        this.mainContainerId = mainContainerId;
        $("body").on("pjax:start", function () { });
        $("body").on("pjax:end", function () { });
        $(document).on("submit", triggerOn, function (event) {
            event.preventDefault();
            self.submitForm(event);
        });
    }
    cleanListeners() {
        this._isLoading = false;
        $("body").off("pjax:complete");
        $("body").off("pjax:error");
        $("body").off("pjax:timeout");
    }
    submitForm(event) {
        const self = this;
        $("body")
            .off("pjax:complete")
            .on("pjax:complete", function () {
            self.cleanListeners();
            self.focusOnPreviousElement();
            self.onLoadFinishCallback(true);
            $(window).scrollTop(self.windowScrollPx);
        });
        $("body")
            .off("pjax:error")
            .on("pjax:error", function (event, xhr, textStatus, errorThrown, options) {
            event.preventDefault();
            self.cleanListeners();
            options.success(xhr.responseText, textStatus, xhr);
            self.cancelRequest(xhr);
            self.onLoadFinishCallback(false);
            return false;
        });
        $("body")
            .off("pjax:timeout")
            .on("pjax:timeout", function (event, xhr, options) {
            event.preventDefault();
            self.cleanListeners();
            self.cancelRequest(xhr);
            self.onLoadFinishCallback(false);
        });
        self._isLoading = true;
        if (document.activeElement) {
            self.focusedElementId = document.activeElement.getAttribute("id");
        }
        self.windowScrollPx = $(window).scrollTop();
        const containerId = self.mainContainerId;
        $.pjax.submit(event, containerId);
        let form = $(event.currentTarget);
        self.onFormLoadStartedCallback(form);
        self.onLoadStartedCallback(true);
    }
    setCancelRequest(cancelRequest) {
        this.cancelRequest = cancelRequest;
    }
    isLoading() {
        return this._isLoading;
    }
    stopLoading() {
        if (!this._isLoading)
            return;
        this.cleanListeners();
        this.cancelRequest();
    }
    setOnLoadStartedListener(callback) {
        this.onLoadStartedCallback = (isNewPage = false, isReloadingPreviousPage) => {
            callback(isNewPage, isReloadingPreviousPage);
        };
    }
    setOnLoadFinishedListener(callback) {
        this.onLoadFinishCallback = success => {
            callback(success);
        };
    }
    setOnFormLoadStartedListener(callback) {
        this.onFormLoadStartedCallback = (form) => {
            callback(form);
        };
    }
    notifyPageChange() { }
    focusOnPreviousElement() {
        const self = this;
        if (self.focusedElementId) {
            let newFocusElement = document.getElementById(self.focusedElementId);
            if (!newFocusElement)
                return;
            newFocusElement.focus();
            if (newFocusElement.value) {
                let currentValue = newFocusElement.value;
                newFocusElement.value = "";
                newFocusElement.value = currentValue;
            }
        }
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvZWxlbWVudHMvYWpheC1sb2FkaW5nL3NjcmlwdHMvRm9ybXNMb2FkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsaUJBQWtCLFNBQVEsVUFBVTtJQUFwQzs7UUFRVSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCLHFCQUFnQixHQUFHLElBQUksQ0FBQztJQW9JbEMsQ0FBQztJQS9IUSxNQUFNLENBQUMsV0FBVztRQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtZQUN6QixXQUFXLENBQUMsUUFBUSxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7U0FDMUM7UUFFRCxPQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUM7SUFDOUIsQ0FBQztJQUVNLElBQUksQ0FBQyxzQkFBMkIsRUFBRSxTQUFjLEVBQUUsZUFBdUI7UUFDOUUsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsQ0FBQztRQUNyRCxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztRQUV2QyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxjQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLGNBQVksQ0FBQyxDQUFDLENBQUM7UUFFeEMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLFVBQVMsS0FBSztZQUNoRCxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxjQUFjO1FBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FB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ZW50cy9hamF4LWxvYWRpbmcvc2NyaXB0cy9Gb3Jtc0xvYWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJCYXNlTG9hZGVyLnRzXCIgLz5cblxuaW50ZXJmYWNlIEpRdWVyeVN0YXRpYyB7XG4gIHBqYXg6IGFueTtcbn1cblxuY2xhc3MgRm9ybXNMb2FkZXIgZXh0ZW5kcyBCYXNlTG9hZGVyIHtcbiAgcHJpdmF0ZSBpc090aGVyTG9hZGluZ0NhbGxiYWNrOiBhbnk7XG4gIHByaXZhdGUgb25Gb3JtTG9hZFN0YXJ0ZWRDYWxsYmFjazogYW55O1xuICBwcml2YXRlIG9uTG9hZFN0YXJ0ZWRDYWxsYmFjazogYW55O1xuICBwcml2YXRlIG9uTG9hZEZpbmlzaENhbGxiYWNrOiBhbnk7XG4gIHByaXZhdGUgdHJpZ2dlck9uOiBhbnk7XG4gIHByaXZhdGUgbWFpbkNvbnRhaW5lcklkOiBhbnk7XG4gIHByaXZhdGUgY2FuY2VsUmVxdWVzdDogKHhoclJlcXVlc3Q/OiBhbnkpID0+IHZvaWQ7XG4gIHByaXZhdGUgX2lzTG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGZvY3VzZWRFbGVtZW50SWQgPSBudWxsO1xuICBwcml2YXRlIHdpbmRvd1Njcm9sbFB4OiBudW1iZXI7XG5cbiAgc3RhdGljIGluc3RhbmNlOiBGb3Jtc0xvYWRlcjtcblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCkge1xuICAgIGlmICghRm9ybXNMb2FkZXIuaW5zdGFuY2UpIHtcbiAgICAgIEZvcm1zTG9hZGVyLmluc3RhbmNlID0gbmV3IEZvcm1zTG9hZGVyKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIEZvcm1zTG9hZGVyLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIGluaXQoaXNPdGhlckxvYWRpbmdDYWxsYmFjazogYW55LCB0cmlnZ2VyT246IGFueSwgbWFpbkNvbnRhaW5lcklkOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMudHJpZ2dlck9uID0gdHJpZ2dlck9uO1xuICAgIHRoaXMuaXNPdGhlckxvYWRpbmdDYWxsYmFjayA9IGlzT3RoZXJMb2FkaW5nQ2FsbGJhY2s7XG4gICAgdGhpcy5tYWluQ29udGFpbmVySWQgPSBtYWluQ29udGFpbmVySWQ7XG5cbiAgICAkKFwiYm9keVwiKS5vbihcInBqYXg6c3RhcnRcIiwgZnVuY3Rpb24oKSB7fSk7XG4gICAgJChcImJvZHlcIikub24oXCJwamF4OmVuZFwiLCBmdW5jdGlvbigpIHt9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKFwic3VibWl0XCIsIHRyaWdnZXJPbiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBzZWxmLnN1Ym1pdEZvcm0oZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhbkxpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAkKFwiYm9keVwiKS5vZmYoXCJwamF4OmNvbXBsZXRlXCIpO1xuICAgICQoXCJib2R5XCIpLm9mZihcInBqYXg6ZXJyb3JcIik7XG4gICAgJChcImJvZHlcIikub2ZmKFwicGpheDp0aW1lb3V0XCIpO1xuICB9XG5cbiAgcHVibGljIHN1Ym1pdEZvcm0oZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgJChcImJvZHlcIilcbiAgICAgIC5vZmYoXCJwamF4OmNvbXBsZXRlXCIpXG4gICAgICAub24oXCJwamF4OmNvbXBsZXRlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLmNsZWFuTGlzdGVuZXJzKCk7XG4gICAgICAgIHNlbGYuZm9jdXNPblByZXZpb3VzRWxlbWVudCgpO1xuICAgICAgICBzZWxmLm9uTG9hZEZpbmlzaENhbGxiYWNrKHRydWUpO1xuICAgICAgICAkKHdpbmRvdykuc2Nyb2xsVG9wKHNlbGYud2luZG93U2Nyb2xsUHgpO1xuICAgICAgfSk7XG5cbiAgICAkKFwiYm9keVwiKVxuICAgICAgLm9mZihcInBqYXg6ZXJyb3JcIilcbiAgICAgIC5vbihcInBqYXg6ZXJyb3JcIiwgZnVuY3Rpb24oZXZlbnQsIHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24sIG9wdGlvbnMpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgc2VsZi5jbGVhbkxpc3RlbmVycygpO1xuICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoeGhyLnJlc3BvbnNlVGV4dCwgdGV4dFN0YXR1cywgeGhyKTtcbiAgICAgICAgc2VsZi5jYW5jZWxSZXF1ZXN0KHhocik7XG4gICAgICAgIHNlbGYub25Mb2FkRmluaXNoQ2FsbGJhY2soZmFsc2UpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICQoXCJib2R5XCIpXG4gICAgICAub2ZmKFwicGpheDp0aW1lb3V0XCIpXG4gICAgICAub24oXCJwamF4OnRpbWVvdXRcIiwgZnVuY3Rpb24oZXZlbnQsIHhociwgb3B0aW9ucykge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBzZWxmLmNsZWFuTGlzdGVuZXJzKCk7XG4gICAgICAgIHNlbGYuY2FuY2VsUmVxdWVzdCh4aHIpO1xuICAgICAgICBzZWxmLm9uTG9hZEZpbmlzaENhbGxiYWNrKGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgc2VsZi5faXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7XG4gICAgICBzZWxmLmZvY3VzZWRFbGVtZW50SWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgIH1cblxuICAgIHNlbGYud2luZG93U2Nyb2xsUHggPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG5cbiAgICBjb25zdCBjb250YWluZXJJZCA9IHNlbGYubWFpbkNvbnRhaW5lcklkO1xuICAgICQucGpheC5zdWJtaXQoZXZlbnQsIGNvbnRhaW5lcklkKTtcblxuICAgIGxldCBmb3JtID0gJChldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICBzZWxmLm9uRm9ybUxvYWRTdGFydGVkQ2FsbGJhY2soZm9ybSk7XG4gICAgc2VsZi5vbkxvYWRTdGFydGVkQ2FsbGJhY2sodHJ1ZSk7XG4gIH1cblxuICBwdWJsaWMgc2V0Q2FuY2VsUmVxdWVzdChjYW5jZWxSZXF1ZXN0OiAoeGhyUmVxdWVzdD86IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuY2FuY2VsUmVxdWVzdCA9IGNhbmNlbFJlcXVlc3Q7XG4gIH1cblxuICBwdWJsaWMgaXNMb2FkaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9pc0xvYWRpbmc7XG4gIH1cblxuICBwdWJsaWMgc3RvcExvYWRpbmcoKSB7XG4gICAgaWYgKCF0aGlzLl9pc0xvYWRpbmcpIHJldHVybjtcbiAgICB0aGlzLmNsZWFuTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5jYW5jZWxSZXF1ZXN0KCk7XG4gIH1cblxuICBwdWJsaWMgc2V0T25Mb2FkU3RhcnRlZExpc3RlbmVyKGNhbGxiYWNrOiAoaXNOZXdQYWdlOiBib29sZWFuLCBpc1JlbG9hZGluZ1ByZXZpb3VzUGFnZTogYm9vbGVhbikgPT4gdm9pZCkge1xuICAgIHRoaXMub25Mb2FkU3RhcnRlZENhbGxiYWNrID0gKGlzTmV3UGFnZTogYm9vbGVhbiA9IGZhbHNlLCBpc1JlbG9hZGluZ1ByZXZpb3VzUGFnZTogYm9vbGVhbikgPT4ge1xuICAgICAgY2FsbGJhY2soaXNOZXdQYWdlLCBpc1JlbG9hZGluZ1ByZXZpb3VzUGFnZSk7XG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRPbkxvYWRGaW5pc2hlZExpc3RlbmVyKGNhbGxiYWNrOiBhbnkpIHtcbiAgICB0aGlzLm9uTG9hZEZpbmlzaENhbGxiYWNrID0gc3VjY2VzcyA9PiB7XG4gICAgICBjYWxsYmFjayhzdWNjZXNzKTtcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHNldE9uRm9ybUxvYWRTdGFydGVkTGlzdGVuZXIoY2FsbGJhY2s6IGFueSkge1xuICAgIHRoaXMub25Gb3JtTG9hZFN0YXJ0ZWRDYWxsYmFjayA9IChmb3JtOiBhbnkpID0+IHtcbiAgICAgIGNhbGxiYWNrKGZvcm0pO1xuICAgIH07XG4gIH1cblxuICBwdWJsaWMgbm90aWZ5UGFnZUNoYW5nZSgpIHt9XG5cbiAgcHJpdmF0ZSBmb2N1c09uUHJldmlvdXNFbGVtZW50KCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgaWYgKHNlbGYuZm9jdXNlZEVsZW1lbnRJZCkge1xuICAgICAgbGV0IG5ld0ZvY3VzRWxlbWVudDogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZi5mb2N1c2VkRWxlbWVudElkKTtcbiAgICAgIGlmICghbmV3Rm9jdXNFbGVtZW50KSByZXR1cm47XG4gICAgICBuZXdGb2N1c0VsZW1lbnQuZm9jdXMoKTtcblxuICAgICAgaWYgKG5ld0ZvY3VzRWxlbWVudC52YWx1ZSkge1xuICAgICAgICBsZXQgY3VycmVudFZhbHVlID0gbmV3Rm9jdXNFbGVtZW50LnZhbHVlO1xuICAgICAgICBuZXdGb2N1c0VsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgICAgICBuZXdGb2N1c0VsZW1lbnQudmFsdWUgPSBjdXJyZW50VmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=
