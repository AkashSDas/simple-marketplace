class MainLoader {
    constructor() {
        this._isLoading = false;
        this._isLoading = false;
    }
    static getInstance() {
        if (!MainLoader.instance) {
            MainLoader.instance = new MainLoader();
        }
        return MainLoader.instance;
    }
    init(mainContainerId, onPageChangeStart, onPageChangeFinish, onUpdatePageMeta = null) {
        this.mainContainerId = mainContainerId;
        this.onPageChangeStart = onPageChangeStart;
        this.onPageChangeFinish = onPageChangeFinish;
        this.onUpdatePageMeta = onUpdatePageMeta;
        if (!this.onUpdatePageMeta)
            this.onUpdatePageMeta = this.defaultOnUpdatePageMeta;
        this.scrollToAnchorLink();
    }
    addLoader(loader, triggerOn) {
        const self = this;
        loader.init(self.isLoading, triggerOn, self.mainContainerId);
        MainLoader.loaders.push(loader);
        loader.setOnLoadStartedListener((isNewPage, isReloadingPreviousPage) => {
            self.onLoadStarted(isNewPage, isReloadingPreviousPage);
        });
        loader.setOnLoadFinishedListener(success => {
            self.onLoadFinish(success);
        });
        loader.setCancelRequest(self.cancelXhrRequest);
    }
    cancelXhrRequest(xhrRequest) {
        if (!xhrRequest)
            xhrRequest = $.pjax.xhr;
        if (!xhrRequest)
            return;
        xhrRequest.onreadystatechange = $.noop;
        xhrRequest.abort();
    }
    isLoading() {
        return this._isLoading;
    }
    stopLoading() {
        if (!this._isLoading)
            return;
        this._isLoading = false;
        for (const loader of MainLoader.loaders) {
            loader.stopLoading();
        }
    }
    onLoadStarted(isNewPage, isReloadingPreviousPage = false) {
        this._isLoading = true;
        this.onPageChangeStart(isNewPage, isReloadingPreviousPage);
    }
    onLoadFinish(success) {
        this._isLoading = false;
        this.onPageChangeFinish(success);
        this.scrollToAnchorLink();
        for (let i = 0; i < MainLoader.loaders.length; i++) {
            let loader = MainLoader.loaders[i];
            loader.notifyPageChange();
        }
        this.onUpdatePageMeta();
    }
    defaultOnUpdatePageMeta() {
        this.updateTitleMeta();
        this.updateKeywordsMeta();
        this.updateDescriptionMeta();
        this.updateContent("#loadedMenu", "header");
    }
    updateTitleMeta(selectorTitle = "#loadedTitle") {
        if ($(selectorTitle).length > 0) {
            document.title = $(selectorTitle).html();
            $(selectorTitle).remove();
        }
    }
    updateKeywordsMeta(selectorKeywords = "#loadedKeywords") {
        if ($(selectorKeywords).length > 0) {
            $("meta[name=Keywords]").remove();
            $("head").append('<meta name="Keywords" content="' + $(selectorKeywords).html() + '">');
            $(selectorKeywords).remove();
        }
    }
    updateDescriptionMeta(selectorDescription = "#loadedDescription") {
        if ($(selectorDescription).length > 0) {
            $("meta[name=Description]").remove();
            $("head").append('<meta name="Description" content="' + $(selectorDescription).html() + '">');
            $(selectorDescription).remove();
        }
    }
    updateContent(loadedSelector, contentSelector) {
        let isLoaded = $(loadedSelector)
            .eq(0)
            .text()
            .trim().length > 0;
        if (isLoaded) {
            let newContent = $(loadedSelector).html();
            $(loadedSelector).remove();
            let contentSelectors = $(contentSelector);
            let removeCount = contentSelectors.length - 1;
            for (let i = 0; i < removeCount; i++) {
                contentSelectors[i].remove();
            }
            $(contentSelector).replaceWith($(newContent));
        }
    }
    scrollToAnchorLink() {
        if (window.location.hash) {
            let isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            if (isChrome) {
                setTimeout(function () {
                    let hash = window.location.hash;
                    window.location.hash = "";
                    window.location.hash = hash;
                }, 300);
            }
        }
    }
}
MainLoader.loaders = new Array();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvZWxlbWVudHMvYWpheC1sb2FkaW5nL3NjcmlwdHMvTWFpbkxvYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTtJQW1CRTtRQVZRLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFXbEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQVZNLE1BQU0sQ0FBQyxXQUFXO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFO1lBQ3hCLFVBQVUsQ0FBQyxRQUFRLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztTQUN4QztRQUVELE9BQU8sVUFBVSxDQUFDLFFBQVEsQ0FBQztJQUM3QixDQUFDO0lBTU0sSUFBSSxDQUFDLGVBQXVCLEVBQUUsaUJBQWlGLEVBQUUsa0JBQXVCLEVBQUUsbUJBQStCLElBQUk7UUFDbEwsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFDdkMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDO1FBQzNDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQztRQUM3QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0I7WUFBRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDO1FBRWpGLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTSxTQUFTLENBQUMsTUFBa0IsRUFBRSxTQUFjO1FBQ2pELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUVsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3RCxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsd0JBQXdCLENB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QWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7YUFDOUI7WUFFRCxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1NBQy9DO0lBQ0gsQ0FBQztJQUdPLGtCQUFrQjtRQUN4QixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFO1lBQ3hCLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3pGLElBQUksUUFBUSxFQUFFO2dCQUNaLFVBQVUsQ0FBQztvQkFDVCxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztvQkFDaEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO29CQUMxQixNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7Z0JBQzlCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzthQUNUO1NBQ0Y7SUFDSCxDQUFDOztBQWxKTSxrQkFBTyxHQUFlLElBQUksS0FBSyxFQUFFLENBQUMiLCJmaWxlIjoic3JjL2NsaWVudC9lbGVtZW50cy9hamF4LWxvYWRpbmcvc2NyaXB0cy9NYWluTG9hZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkJhc2VMb2FkZXIudHNcIiAvPlxuXG5jbGFzcyBNYWluTG9hZGVyIHtcbiAgc3RhdGljIGluc3RhbmNlOiBNYWluTG9hZGVyO1xuICBzdGF0aWMgbG9hZGVyczogQXJyYXk8YW55PiA9IG5ldyBBcnJheSgpO1xuXG4gIHByaXZhdGUgbWFpbkNvbnRhaW5lcklkOiBzdHJpbmc7XG4gIHByaXZhdGUgb25QYWdlQ2hhbmdlU3RhcnQ6IChpc05ld1BhZ2U6IGJvb2xlYW4sIGlzUmVsb2FkaW5nUHJldmlvdXNQYWdlOiBib29sZWFuKSA9PiB2b2lkO1xuICBwcml2YXRlIG9uUGFnZUNoYW5nZUZpbmlzaDogYW55O1xuICBwcml2YXRlIG9uVXBkYXRlUGFnZU1ldGE6ICgpID0+IHZvaWQ7XG5cbiAgcHJpdmF0ZSBfaXNMb2FkaW5nOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICBpZiAoIU1haW5Mb2FkZXIuaW5zdGFuY2UpIHtcbiAgICAgIE1haW5Mb2FkZXIuaW5zdGFuY2UgPSBuZXcgTWFpbkxvYWRlcigpO1xuICAgIH1cblxuICAgIHJldHVybiBNYWluTG9hZGVyLmluc3RhbmNlO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5faXNMb2FkaW5nID0gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgaW5pdChtYWluQ29udGFpbmVySWQ6IHN0cmluZywgb25QYWdlQ2hhbmdlU3RhcnQ6IChpc05ld1BhZ2U6IGJvb2xlYW4sIGlzUmVsb2FkaW5nUHJldmlvdXNQYWdlOiBib29sZWFuKSA9PiB2b2lkLCBvblBhZ2VDaGFuZ2VGaW5pc2g6IGFueSwgb25VcGRhdGVQYWdlTWV0YTogKCkgPT4gdm9pZCA9IG51bGwpIHtcbiAgICB0aGlzLm1haW5Db250YWluZXJJZCA9IG1haW5Db250YWluZXJJZDtcbiAgICB0aGlzLm9uUGFnZUNoYW5nZVN0YXJ0ID0gb25QYWdlQ2hhbmdlU3RhcnQ7XG4gICAgdGhpcy5vblBhZ2VDaGFuZ2VGaW5pc2ggPSBvblBhZ2VDaGFuZ2VGaW5pc2g7XG4gICAgdGhpcy5vblVwZGF0ZVBhZ2VNZXRhID0gb25VcGRhdGVQYWdlTWV0YTtcbiAgICBpZiAoIXRoaXMub25VcGRhdGVQYWdlTWV0YSkgdGhpcy5vblVwZGF0ZVBhZ2VNZXRhID0gdGhpcy5kZWZhdWx0T25VcGRhdGVQYWdlTWV0YTtcblxuICAgIHRoaXMuc2Nyb2xsVG9BbmNob3JMaW5rKCk7XG4gIH1cblxuICBwdWJsaWMgYWRkTG9hZGVyKGxvYWRlcjogQmFzZUxvYWRlciwgdHJpZ2dlck9uOiBhbnkpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgIGxvYWRlci5pbml0KHNlbGYuaXNMb2FkaW5nLCB0cmlnZ2VyT24sIHNlbGYubWFpbkNvbnRhaW5lcklkKTtcbiAgICBNYWluTG9hZGVyLmxvYWRlcnMucHVzaChsb2FkZXIpO1xuICAgIGxvYWRlci5zZXRPbkxvYWRTdGFydGVkTGlzdGVuZXIoKGlzTmV3UGFnZTogYm9vbGVhbiwgaXNSZWxvYWRpbmdQcmV2aW91c1BhZ2U6IGJvb2xlYW4pID0+IHtcbiAgICAgIHNlbGYub25Mb2FkU3RhcnRlZChpc05ld1BhZ2UsIGlzUmVsb2FkaW5nUHJldmlvdXNQYWdlKTtcbiAgICB9KTtcbiAgICBsb2FkZXIuc2V0T25Mb2FkRmluaXNoZWRMaXN0ZW5lcihzdWNjZXNzID0+IHtcbiAgICAgIHNlbGYub25Mb2FkRmluaXNoKHN1Y2Nlc3MpO1xuICAgIH0pO1xuICAgIGxvYWRlci5zZXRDYW5jZWxSZXF1ZXN0KHNlbGYuY2FuY2VsWGhyUmVxdWVzdCk7XG4gIH1cblxuICBjYW5jZWxYaHJSZXF1ZXN0KHhoclJlcXVlc3Q/OiBhbnkpIHtcbiAgICBpZiAoIXhoclJlcXVlc3QpIHhoclJlcXVlc3QgPSAkLnBqYXgueGhyO1xuICAgIGlmICgheGhyUmVxdWVzdCkgcmV0dXJuO1xuICAgIHhoclJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gJC5ub29wO1xuICAgIHhoclJlcXVlc3QuYWJvcnQoKTtcbiAgfVxuXG4gIGlzTG9hZGluZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faXNMb2FkaW5nO1xuICB9XG5cbiAgc3RvcExvYWRpbmcoKSB7XG4gICAgaWYgKCF0aGlzLl9pc0xvYWRpbmcpIHJldHVybjtcbiAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcblxuICAgIGZvciAoY29uc3QgbG9hZGVyIG9mIE1haW5Mb2FkZXIubG9hZGVycykge1xuICAgICAgbG9hZGVyLnN0b3BMb2FkaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvbkxvYWRTdGFydGVkKGlzTmV3UGFnZTogYm9vbGVhbiwgaXNSZWxvYWRpbmdQcmV2aW91c1BhZ2U6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIHRoaXMuX2lzTG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5vblBhZ2VDaGFuZ2VTdGFydChpc05ld1BhZ2UsIGlzUmVsb2FkaW5nUHJldmlvdXNQYWdlKTtcbiAgfVxuXG4gIHByaXZhdGUgb25Mb2FkRmluaXNoKHN1Y2Nlc3M6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLm9uUGFnZUNoYW5nZUZpbmlzaChzdWNjZXNzKTtcbiAgICB0aGlzLnNjcm9sbFRvQW5jaG9yTGluaygpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYWluTG9hZGVyLmxvYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBsb2FkZXIgPSBNYWluTG9hZGVyLmxvYWRlcnNbaV07XG4gICAgICBsb2FkZXIubm90aWZ5UGFnZUNoYW5nZSgpO1xuICAgIH1cblxuICAgIHRoaXMub25VcGRhdGVQYWdlTWV0YSgpO1xuICB9XG5cbiAgcHVibGljIGRlZmF1bHRPblVwZGF0ZVBhZ2VNZXRhKCkge1xuICAgIHRoaXMudXBkYXRlVGl0bGVNZXRhKCk7XG4gICAgdGhpcy51cGRhdGVLZXl3b3Jkc01ldGEoKTtcbiAgICB0aGlzLnVwZGF0ZURlc2NyaXB0aW9uTWV0YSgpO1xuICAgIHRoaXMudXBkYXRlQ29udGVudChcIiNsb2FkZWRNZW51XCIsIFwiaGVhZGVyXCIpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZVRpdGxlTWV0YShzZWxlY3RvclRpdGxlID0gXCIjbG9hZGVkVGl0bGVcIikge1xuICAgIGlmICgkKHNlbGVjdG9yVGl0bGUpLmxlbmd0aCA+IDApIHtcbiAgICAgIGRvY3VtZW50LnRpdGxlID0gJChzZWxlY3RvclRpdGxlKS5odG1sKCk7XG4gICAgICAkKHNlbGVjdG9yVGl0bGUpLnJlbW92ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVLZXl3b3Jkc01ldGEoc2VsZWN0b3JLZXl3b3JkcyA9IFwiI2xvYWRlZEtleXdvcmRzXCIpIHtcbiAgICBpZiAoJChzZWxlY3RvcktleXdvcmRzKS5sZW5ndGggPiAwKSB7XG4gICAgICAkKFwibWV0YVtuYW1lPUtleXdvcmRzXVwiKS5yZW1vdmUoKTtcbiAgICAgICQoXCJoZWFkXCIpLmFwcGVuZCgnPG1ldGEgbmFtZT1cIktleXdvcmRzXCIgY29udGVudD1cIicgKyAkKHNlbGVjdG9yS2V5d29yZHMpLmh0bWwoKSArICdcIj4nKTtcbiAgICAgICQoc2VsZWN0b3JLZXl3b3JkcykucmVtb3ZlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVwZGF0ZURlc2NyaXB0aW9uTWV0YShzZWxlY3RvckRlc2NyaXB0aW9uID0gXCIjbG9hZGVkRGVzY3JpcHRpb25cIikge1xuICAgIGlmICgkKHNlbGVjdG9yRGVzY3JpcHRpb24pLmxlbmd0aCA+IDApIHtcbiAgICAgICQoXCJtZXRhW25hbWU9RGVzY3JpcHRpb25dXCIpLnJlbW92ZSgpO1xuICAgICAgJChcImhlYWRcIikuYXBwZW5kKCc8bWV0YSBuYW1lPVwiRGVzY3JpcHRpb25cIiBjb250ZW50PVwiJyArICQoc2VsZWN0b3JEZXNjcmlwdGlvbikuaHRtbCgpICsgJ1wiPicpO1xuICAgICAgJChzZWxlY3RvckRlc2NyaXB0aW9uKS5yZW1vdmUoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlQ29udGVudChsb2FkZWRTZWxlY3Rvcjogc3RyaW5nLCBjb250ZW50U2VsZWN0b3I6IHN0cmluZykge1xuICAgIGxldCBpc0xvYWRlZCA9XG4gICAgICAkKGxvYWRlZFNlbGVjdG9yKVxuICAgICAgICAuZXEoMClcbiAgICAgICAgLnRleHQoKVxuICAgICAgICAudHJpbSgpLmxlbmd0aCA+IDA7XG5cbiAgICBpZiAoaXNMb2FkZWQpIHtcbiAgICAgIGxldCBuZXdDb250ZW50ID0gJChsb2FkZWRTZWxlY3RvcikuaHRtbCgpO1xuICAgICAgJChsb2FkZWRTZWxlY3RvcikucmVtb3ZlKCk7XG5cbiAgICAgIGxldCBjb250ZW50U2VsZWN0b3JzID0gJChjb250ZW50U2VsZWN0b3IpO1xuICAgICAgbGV0IHJlbW92ZUNvdW50ID0gY29udGVudFNlbGVjdG9ycy5sZW5ndGggLSAxO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZW1vdmVDb3VudDsgaSsrKSB7XG4gICAgICAgIGNvbnRlbnRTZWxlY3RvcnNbaV0ucmVtb3ZlKCk7XG4gICAgICB9XG5cbiAgICAgICQoY29udGVudFNlbGVjdG9yKS5yZXBsYWNlV2l0aCgkKG5ld0NvbnRlbnQpKTtcbiAgICB9XG4gIH1cblxuICAvLyBJdCdzIGEgaGFjayBvbiBDaHJvbWUgYnJvd3NlciB0byBzY3JvbGwgdG8gYW5jaG9yIGxpbmtzXG4gIHByaXZhdGUgc2Nyb2xsVG9BbmNob3JMaW5rKCkge1xuICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuICAgICAgbGV0IGlzQ2hyb21lID0gL0Nocm9tZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAvR29vZ2xlIEluYy8udGVzdChuYXZpZ2F0b3IudmVuZG9yKTtcbiAgICAgIGlmIChpc0Nocm9tZSkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGxldCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBcIlwiO1xuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gaGFzaDtcbiAgICAgICAgfSwgMzAwKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==
